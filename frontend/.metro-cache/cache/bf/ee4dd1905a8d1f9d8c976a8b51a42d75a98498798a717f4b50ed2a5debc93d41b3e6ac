{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":26,"index":105}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}},{"name":"../utils/storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":43,"index":149}}],"key":"rswhtWQFlk40P6/ZSXiz3NZSC0I=","exportNames":["*"],"imports":1}},{"name":"./AuthContext","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":40,"index":190}}],"key":"YmpzODa+dVz64UAAYTI+RwJeEt0=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/MessagesContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useMessages\", {\n    enumerable: true,\n    get: function () {\n      return useMessages;\n    }\n  });\n  Object.defineProperty(exports, \"MessagesProvider\", {\n    enumerable: true,\n    get: function () {\n      return MessagesProvider;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _react = require(_dependencyMap[1], \"react\");\n  var _axios = require(_dependencyMap[2], \"axios\");\n  var axios = _interopDefault(_axios);\n  var _utilsStorage = require(_dependencyMap[3], \"../utils/storage\");\n  var _AuthContext = require(_dependencyMap[4], \"./AuthContext\");\n  var _reactJsxDevRuntime = require(_dependencyMap[5], \"react/jsx-dev-runtime\");\n  const API_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL + '/api';\n  const MessagesContext = /*#__PURE__*/(0, _react.createContext)({\n    unreadCount: 0,\n    refreshUnreadCount: async () => {}\n  });\n  const useMessages = () => {\n    _s();\n    return (0, _react.useContext)(MessagesContext);\n  };\n  _s(useMessages, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n  const MessagesProvider = ({\n    children\n  }) => {\n    _s2();\n    const {\n      user\n    } = (0, _AuthContext.useAuth)();\n    const [unreadCount, setUnreadCount] = (0, _react.useState)(0);\n    const refreshUnreadCount = async () => {\n      if (!user) {\n        setUnreadCount(0);\n        return;\n      }\n      try {\n        const token = await _utilsStorage.storage.getItemAsync('session_token');\n        const response = await axios.default.get(`${API_URL}/conversations`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const conversations = response.data;\n        // Count number of conversations with unread messages (not total unread count)\n        let unreadChatsCount = 0;\n        conversations.forEach(conv => {\n          const hasUnread = conv.user1_id === user._id ? (conv.unread_count_user1 || 0) > 0 : (conv.unread_count_user2 || 0) > 0;\n          if (hasUnread) unreadChatsCount++;\n        });\n        setUnreadCount(unreadChatsCount);\n      } catch (error) {\n        console.error('Error fetching unread messages count:', error);\n      }\n    };\n    (0, _react.useEffect)(() => {\n      if (user) {\n        refreshUnreadCount();\n\n        // Refresh every 30 seconds\n        const interval = setInterval(refreshUnreadCount, 30000);\n        return () => clearInterval(interval);\n      }\n    }, [user]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(MessagesContext.Provider, {\n      value: {\n        unreadCount,\n        refreshUnreadCount\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 5\n    }, this);\n  };\n  _s2(MessagesProvider, \"5uz6nrhCjtb8dvvfCS3TSGZnyrs=\", false, function () {\n    return [_AuthContext.useAuth];\n  });\n  _c = MessagesProvider;\n  var _c;\n  $RefreshReg$(_c, \"MessagesProvider\");\n});","lineCount":103,"map":[[15,2,18,0,"Object"],[15,8,18,0],[15,9,18,0,"defineProperty"],[15,23,18,0],[15,24,18,0,"exports"],[15,31,18,0],[16,4,18,0,"enumerable"],[16,14,18,0],[17,4,18,0,"get"],[17,7,18,0],[17,18,18,0,"get"],[17,19,18,0],[18,6,18,0],[18,13,18,0,"useMessages"],[18,24,18,0],[19,4,18,0],[20,2,18,0],[21,2,20,0,"Object"],[21,8,20,0],[21,9,20,0,"defineProperty"],[21,23,20,0],[21,24,20,0,"exports"],[21,31,20,0],[22,4,20,0,"enumerable"],[22,14,20,0],[23,4,20,0,"get"],[23,7,20,0],[23,18,20,0,"get"],[23,19,20,0],[24,6,20,0],[24,13,20,0,"MessagesProvider"],[24,29,20,0],[25,4,20,0],[26,2,20,0],[27,2,67,2],[27,6,67,2,"_expoVirtualEnv"],[27,21,67,2],[27,24,67,2,"require"],[27,31,67,2],[27,32,67,2,"_dependencyMap"],[27,46,67,2],[28,2,1,0],[28,6,1,0,"_react"],[28,12,1,0],[28,15,1,0,"require"],[28,22,1,0],[28,23,1,0,"_dependencyMap"],[28,37,1,0],[29,2,2,0],[29,6,2,0,"_axios"],[29,12,2,0],[29,15,2,0,"require"],[29,22,2,0],[29,23,2,0,"_dependencyMap"],[29,37,2,0],[30,2,2,0],[30,6,2,0,"axios"],[30,11,2,0],[30,14,2,0,"_interopDefault"],[30,29,2,0],[30,30,2,0,"_axios"],[30,36,2,0],[31,2,3,0],[31,6,3,0,"_utilsStorage"],[31,19,3,0],[31,22,3,0,"require"],[31,29,3,0],[31,30,3,0,"_dependencyMap"],[31,44,3,0],[32,2,4,0],[32,6,4,0,"_AuthContext"],[32,18,4,0],[32,21,4,0,"require"],[32,28,4,0],[32,29,4,0,"_dependencyMap"],[32,43,4,0],[33,2,4,40],[33,6,4,40,"_reactJsxDevRuntime"],[33,25,4,40],[33,28,4,40,"require"],[33,35,4,40],[33,36,4,40,"_dependencyMap"],[33,50,4,40],[34,2,6,0],[34,8,6,6,"API_URL"],[34,15,6,13],[34,18,6,16,"_expoVirtualEnv"],[34,33,6,16],[34,34,6,16,"env"],[34,37,6,16],[34,38,6,16,"EXPO_PUBLIC_BACKEND_URL"],[34,61,6,16],[34,64,6,54],[34,70,6,60],[35,2,13,0],[35,8,13,6,"MessagesContext"],[35,23,13,21],[35,39,13,24],[35,43,13,24,"createContext"],[35,49,13,37],[35,50,13,37,"createContext"],[35,63,13,37],[35,65,13,59],[36,4,14,2,"unreadCount"],[36,15,14,13],[36,17,14,15],[36,18,14,16],[37,4,15,2,"refreshUnreadCount"],[37,22,15,20],[37,24,15,22],[37,30,15,22,"refreshUnreadCount"],[37,31,15,22],[37,36,15,34],[37,37,15,35],[38,2,16,0],[38,3,16,1],[38,4,16,2],[39,2,18,7],[39,8,18,13,"useMessages"],[39,19,18,24],[39,22,18,27,"useMessages"],[39,23,18,27],[40,4,18,27,"_s"],[40,6,18,27],[41,4,18,27],[41,11,18,33],[41,15,18,33,"useContext"],[41,21,18,43],[41,22,18,43,"useContext"],[41,32,18,43],[41,34,18,44,"MessagesContext"],[41,49,18,59],[41,50,18,60],[42,2,18,60],[43,2,18,61,"_s"],[43,4,18,61],[43,5,18,13,"useMessages"],[43,16,18,24],[44,2,20,7],[44,8,20,13,"MessagesProvider"],[44,24,20,70],[44,27,20,73,"MessagesProvider"],[44,28,20,74],[45,4,20,76,"children"],[46,2,20,85],[46,3,20,86],[46,8,20,91],[47,4,20,91,"_s2"],[47,7,20,91],[48,4,21,2],[48,10,21,8],[49,6,21,10,"user"],[50,4,21,15],[50,5,21,16],[50,8,21,19],[50,12,21,19,"useAuth"],[50,24,21,26],[50,25,21,26,"useAuth"],[50,32,21,26],[50,34,21,27],[50,35,21,28],[51,4,22,2],[51,10,22,8],[51,11,22,9,"unreadCount"],[51,22,22,20],[51,24,22,22,"setUnreadCount"],[51,38,22,36],[51,39,22,37],[51,42,22,40],[51,46,22,40,"useState"],[51,52,22,48],[51,53,22,48,"useState"],[51,61,22,48],[51,63,22,49],[51,64,22,50],[51,65,22,51],[52,4,24,2],[52,10,24,8,"refreshUnreadCount"],[52,28,24,26],[52,31,24,29],[52,37,24,29,"refreshUnreadCount"],[52,38,24,29],[52,43,24,41],[53,6,25,4],[53,10,25,8],[53,11,25,9,"user"],[53,15,25,13],[53,17,25,15],[54,8,26,6,"setUnreadCount"],[54,22,26,20],[54,23,26,21],[54,24,26,22],[54,25,26,23],[55,8,27,6],[56,6,28,4],[57,6,30,4],[57,10,30,8],[58,8,31,6],[58,14,31,12,"token"],[58,19,31,17],[58,22,31,20],[58,28,31,26,"storage"],[58,41,31,33],[58,42,31,33,"storage"],[58,49,31,33],[58,50,31,34,"getItemAsync"],[58,62,31,46],[58,63,31,47],[58,78,31,62],[58,79,31,63],[59,8,32,6],[59,14,32,12,"response"],[59,22,32,20],[59,25,32,23],[59,31,32,29,"axios"],[59,36,32,34],[59,37,32,34,"default"],[59,44,32,34],[59,45,32,35,"get"],[59,48,32,38],[59,49,32,39],[59,52,32,42,"API_URL"],[59,59,32,49],[59,75,32,65],[59,77,32,67],[60,10,33,8,"headers"],[60,17,33,15],[60,19,33,17],[61,12,33,19,"Authorization"],[61,25,33,32],[61,27,33,34],[61,37,33,44,"token"],[61,42,33,49],[62,10,33,52],[63,8,34,6],[63,9,34,7],[63,10,34,8],[64,8,36,6],[64,14,36,12,"conversations"],[64,27,36,25],[64,30,36,28,"response"],[64,38,36,36],[64,39,36,37,"data"],[64,43,36,41],[65,8,37,6],[66,8,38,6],[66,12,38,10,"unreadChatsCount"],[66,28,38,26],[66,31,38,29],[66,32,38,30],[67,8,39,6,"conversations"],[67,21,39,19],[67,22,39,20,"forEach"],[67,29,39,27],[67,30,39,29,"conv"],[67,34,39,38],[67,38,39,43],[68,10,40,8],[68,16,40,14,"hasUnread"],[68,25,40,23],[68,28,40,26,"conv"],[68,32,40,30],[68,33,40,31,"user1_id"],[68,41,40,39],[68,46,40,44,"user"],[68,50,40,48],[68,51,40,49,"_id"],[68,54,40,52],[68,57,41,12],[68,58,41,13,"conv"],[68,62,41,17],[68,63,41,18,"unread_count_user1"],[68,81,41,36],[68,85,41,40],[68,86,41,41],[68,90,41,45],[68,91,41,46],[68,94,42,12],[68,95,42,13,"conv"],[68,99,42,17],[68,100,42,18,"unread_count_user2"],[68,118,42,36],[68,122,42,40],[68,123,42,41],[68,127,42,45],[68,128,42,46],[69,10,43,8],[69,14,43,12,"hasUnread"],[69,23,43,21],[69,25,43,23,"unreadChatsCount"],[69,41,43,39],[69,43,43,41],[70,8,44,6],[70,9,44,7],[70,10,44,8],[71,8,46,6,"setUnreadCount"],[71,22,46,20],[71,23,46,21,"unreadChatsCount"],[71,39,46,37],[71,40,46,38],[72,6,47,4],[72,7,47,5],[72,8,47,6],[72,15,47,13,"error"],[72,20,47,18],[72,22,47,20],[73,8,48,6,"console"],[73,15,48,13],[73,16,48,14,"error"],[73,21,48,19],[73,22,48,20],[73,61,48,59],[73,63,48,61,"error"],[73,68,48,66],[73,69,48,67],[74,6,49,4],[75,4,50,2],[75,5,50,3],[76,4,52,2],[76,8,52,2,"useEffect"],[76,14,52,11],[76,15,52,11,"useEffect"],[76,24,52,11],[76,26,52,12],[76,32,52,18],[77,6,53,4],[77,10,53,8,"user"],[77,14,53,12],[77,16,53,14],[78,8,54,6,"refreshUnreadCount"],[78,26,54,24],[78,27,54,25],[78,28,54,26],[80,8,56,6],[81,8,57,6],[81,14,57,12,"interval"],[81,22,57,20],[81,25,57,23,"setInterval"],[81,36,57,34],[81,37,57,35,"refreshUnreadCount"],[81,55,57,53],[81,57,57,55],[81,62,57,60],[81,63,57,61],[82,8,58,6],[82,15,58,13],[82,21,58,19,"clearInterval"],[82,34,58,32],[82,35,58,33,"interval"],[82,43,58,41],[82,44,58,42],[83,6,59,4],[84,4,60,2],[84,5,60,3],[84,7,60,5],[84,8,60,6,"user"],[84,12,60,10],[84,13,60,11],[84,14,60,12],[85,4,62,2],[85,24,63,4],[85,28,63,4,"_reactJsxDevRuntime"],[85,47,63,4],[85,48,63,4,"jsxDEV"],[85,54,63,4],[85,56,63,5,"MessagesContext"],[85,71,63,20],[85,72,63,21,"Provider"],[85,80,63,29],[86,6,63,30,"value"],[86,11,63,35],[86,13,63,37],[87,8,63,39,"unreadCount"],[87,19,63,50],[88,8,63,52,"refreshUnreadCount"],[89,6,63,71],[89,7,63,73],[90,6,63,73,"children"],[90,14,63,73],[90,16,64,7,"children"],[91,4,64,15],[92,6,64,15,"fileName"],[92,14,64,15],[92,16,64,15,"_jsxFileName"],[92,28,64,15],[93,6,64,15,"lineNumber"],[93,16,64,15],[94,6,64,15,"columnNumber"],[94,18,64,15],[95,4,64,15],[95,11,65,30],[95,12,65,31],[96,2,67,0],[96,3,67,1],[97,2,67,2,"_s2"],[97,5,67,2],[97,6,20,13,"MessagesProvider"],[97,22,20,70],[98,4,20,70],[98,12,21,19,"useAuth"],[98,24,21,26],[98,25,21,26,"useAuth"],[98,32,21,26],[99,2,21,26],[100,2,21,26,"_c"],[100,4,21,26],[100,7,20,13,"MessagesProvider"],[100,23,20,70],[101,2,20,70],[101,6,20,70,"_c"],[101,8,20,70],[102,2,20,70,"$RefreshReg$"],[102,14,20,70],[102,15,20,70,"_c"],[102,17,20,70],[103,0,20,70],[103,3]],"functionMap":{"names":["<global>","createContext$argument_0.refreshUnreadCount","useMessages","MessagesProvider","refreshUnreadCount","conversations.forEach$argument_0","useEffect$argument_0","<anonymous>"],"mappings":"AAA;sBCc,cD;2BEG,iCF;yEGE;6BCI;4BCe;ODK;GDM;YGE;aCM,6BD;GHE;CHO"},"hasCjsExports":false},"type":"js/module"}]}