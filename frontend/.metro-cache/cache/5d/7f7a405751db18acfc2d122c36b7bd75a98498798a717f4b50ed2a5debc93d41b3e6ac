{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":26,"index":105}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}},{"name":"../utils/storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":43,"index":149}}],"key":"rswhtWQFlk40P6/ZSXiz3NZSC0I=","exportNames":["*"],"imports":1}},{"name":"./AuthContext","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":40,"index":190}}],"key":"YmpzODa+dVz64UAAYTI+RwJeEt0=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/MessagesContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useMessages\", {\n    enumerable: true,\n    get: function () {\n      return useMessages;\n    }\n  });\n  Object.defineProperty(exports, \"MessagesProvider\", {\n    enumerable: true,\n    get: function () {\n      return MessagesProvider;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _axios = require(_dependencyMap[1], \"axios\");\n  var axios = _interopDefault(_axios);\n  var _utilsStorage = require(_dependencyMap[2], \"../utils/storage\");\n  var _AuthContext = require(_dependencyMap[3], \"./AuthContext\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const API_URL = process.env.EXPO_PUBLIC_BACKEND_URL + '/api';\n  const MessagesContext = /*#__PURE__*/(0, _react.createContext)({\n    unreadCount: 0,\n    refreshUnreadCount: async () => {}\n  });\n  const useMessages = () => (0, _react.useContext)(MessagesContext);\n  const MessagesProvider = ({\n    children\n  }) => {\n    const {\n      user\n    } = (0, _AuthContext.useAuth)();\n    const [unreadCount, setUnreadCount] = (0, _react.useState)(0);\n    const refreshUnreadCount = async () => {\n      if (!user) {\n        setUnreadCount(0);\n        return;\n      }\n      try {\n        const token = await _utilsStorage.storage.getItemAsync('session_token');\n        const response = await axios.default.get(`${API_URL}/conversations`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const conversations = response.data;\n        // Count number of conversations with unread messages (not total unread count)\n        let unreadChatsCount = 0;\n        conversations.forEach(conv => {\n          const hasUnread = conv.user1_id === user._id ? (conv.unread_count_user1 || 0) > 0 : (conv.unread_count_user2 || 0) > 0;\n          if (hasUnread) unreadChatsCount++;\n        });\n        setUnreadCount(unreadChatsCount);\n      } catch (error) {\n        console.error('Error fetching unread messages count:', error);\n      }\n    };\n    (0, _react.useEffect)(() => {\n      if (user) {\n        refreshUnreadCount();\n\n        // Refresh every 30 seconds\n        const interval = setInterval(refreshUnreadCount, 30000);\n        return () => clearInterval(interval);\n      }\n    }, [user]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(MessagesContext.Provider, {\n      value: {\n        unreadCount,\n        refreshUnreadCount\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 5\n    }, this);\n  };\n});","lineCount":89,"map":[[13,2,18,0,"Object"],[13,8,18,0],[13,9,18,0,"defineProperty"],[13,23,18,0],[13,24,18,0,"exports"],[13,31,18,0],[14,4,18,0,"enumerable"],[14,14,18,0],[15,4,18,0,"get"],[15,7,18,0],[15,18,18,0,"get"],[15,19,18,0],[16,6,18,0],[16,13,18,0,"useMessages"],[16,24,18,0],[17,4,18,0],[18,2,18,0],[19,2,20,0,"Object"],[19,8,20,0],[19,9,20,0,"defineProperty"],[19,23,20,0],[19,24,20,0,"exports"],[19,31,20,0],[20,4,20,0,"enumerable"],[20,14,20,0],[21,4,20,0,"get"],[21,7,20,0],[21,18,20,0,"get"],[21,19,20,0],[22,6,20,0],[22,13,20,0,"MessagesProvider"],[22,29,20,0],[23,4,20,0],[24,2,20,0],[25,2,1,0],[25,6,1,0,"_react"],[25,12,1,0],[25,15,1,0,"require"],[25,22,1,0],[25,23,1,0,"_dependencyMap"],[25,37,1,0],[26,2,2,0],[26,6,2,0,"_axios"],[26,12,2,0],[26,15,2,0,"require"],[26,22,2,0],[26,23,2,0,"_dependencyMap"],[26,37,2,0],[27,2,2,0],[27,6,2,0,"axios"],[27,11,2,0],[27,14,2,0,"_interopDefault"],[27,29,2,0],[27,30,2,0,"_axios"],[27,36,2,0],[28,2,3,0],[28,6,3,0,"_utilsStorage"],[28,19,3,0],[28,22,3,0,"require"],[28,29,3,0],[28,30,3,0,"_dependencyMap"],[28,44,3,0],[29,2,4,0],[29,6,4,0,"_AuthContext"],[29,18,4,0],[29,21,4,0,"require"],[29,28,4,0],[29,29,4,0,"_dependencyMap"],[29,43,4,0],[30,2,4,40],[30,6,4,40,"_reactJsxDevRuntime"],[30,25,4,40],[30,28,4,40,"require"],[30,35,4,40],[30,36,4,40,"_dependencyMap"],[30,50,4,40],[31,2,6,0],[31,8,6,6,"API_URL"],[31,15,6,13],[31,18,6,16,"process"],[31,25,6,23],[31,26,6,24,"env"],[31,29,6,27],[31,30,6,28,"EXPO_PUBLIC_BACKEND_URL"],[31,53,6,51],[31,56,6,54],[31,62,6,60],[32,2,13,0],[32,8,13,6,"MessagesContext"],[32,23,13,21],[32,39,13,24],[32,43,13,24,"createContext"],[32,49,13,37],[32,50,13,37,"createContext"],[32,63,13,37],[32,65,13,59],[33,4,14,2,"unreadCount"],[33,15,14,13],[33,17,14,15],[33,18,14,16],[34,4,15,2,"refreshUnreadCount"],[34,22,15,20],[34,24,15,22],[34,30,15,22,"refreshUnreadCount"],[34,31,15,22],[34,36,15,34],[34,37,15,35],[35,2,16,0],[35,3,16,1],[35,4,16,2],[36,2,18,7],[36,8,18,13,"useMessages"],[36,19,18,24],[36,22,18,27,"useMessages"],[36,23,18,27],[36,28,18,33],[36,32,18,33,"useContext"],[36,38,18,43],[36,39,18,43,"useContext"],[36,49,18,43],[36,51,18,44,"MessagesContext"],[36,66,18,59],[36,67,18,60],[37,2,20,7],[37,8,20,13,"MessagesProvider"],[37,24,20,70],[37,27,20,73,"MessagesProvider"],[37,28,20,74],[38,4,20,76,"children"],[39,2,20,85],[39,3,20,86],[39,8,20,91],[40,4,21,2],[40,10,21,8],[41,6,21,10,"user"],[42,4,21,15],[42,5,21,16],[42,8,21,19],[42,12,21,19,"useAuth"],[42,24,21,26],[42,25,21,26,"useAuth"],[42,32,21,26],[42,34,21,27],[42,35,21,28],[43,4,22,2],[43,10,22,8],[43,11,22,9,"unreadCount"],[43,22,22,20],[43,24,22,22,"setUnreadCount"],[43,38,22,36],[43,39,22,37],[43,42,22,40],[43,46,22,40,"useState"],[43,52,22,48],[43,53,22,48,"useState"],[43,61,22,48],[43,63,22,49],[43,64,22,50],[43,65,22,51],[44,4,24,2],[44,10,24,8,"refreshUnreadCount"],[44,28,24,26],[44,31,24,29],[44,37,24,29,"refreshUnreadCount"],[44,38,24,29],[44,43,24,41],[45,6,25,4],[45,10,25,8],[45,11,25,9,"user"],[45,15,25,13],[45,17,25,15],[46,8,26,6,"setUnreadCount"],[46,22,26,20],[46,23,26,21],[46,24,26,22],[46,25,26,23],[47,8,27,6],[48,6,28,4],[49,6,30,4],[49,10,30,8],[50,8,31,6],[50,14,31,12,"token"],[50,19,31,17],[50,22,31,20],[50,28,31,26,"storage"],[50,41,31,33],[50,42,31,33,"storage"],[50,49,31,33],[50,50,31,34,"getItemAsync"],[50,62,31,46],[50,63,31,47],[50,78,31,62],[50,79,31,63],[51,8,32,6],[51,14,32,12,"response"],[51,22,32,20],[51,25,32,23],[51,31,32,29,"axios"],[51,36,32,34],[51,37,32,34,"default"],[51,44,32,34],[51,45,32,35,"get"],[51,48,32,38],[51,49,32,39],[51,52,32,42,"API_URL"],[51,59,32,49],[51,75,32,65],[51,77,32,67],[52,10,33,8,"headers"],[52,17,33,15],[52,19,33,17],[53,12,33,19,"Authorization"],[53,25,33,32],[53,27,33,34],[53,37,33,44,"token"],[53,42,33,49],[54,10,33,52],[55,8,34,6],[55,9,34,7],[55,10,34,8],[56,8,36,6],[56,14,36,12,"conversations"],[56,27,36,25],[56,30,36,28,"response"],[56,38,36,36],[56,39,36,37,"data"],[56,43,36,41],[57,8,37,6],[58,8,38,6],[58,12,38,10,"unreadChatsCount"],[58,28,38,26],[58,31,38,29],[58,32,38,30],[59,8,39,6,"conversations"],[59,21,39,19],[59,22,39,20,"forEach"],[59,29,39,27],[59,30,39,29,"conv"],[59,34,39,38],[59,38,39,43],[60,10,40,8],[60,16,40,14,"hasUnread"],[60,25,40,23],[60,28,40,26,"conv"],[60,32,40,30],[60,33,40,31,"user1_id"],[60,41,40,39],[60,46,40,44,"user"],[60,50,40,48],[60,51,40,49,"_id"],[60,54,40,52],[60,57,41,12],[60,58,41,13,"conv"],[60,62,41,17],[60,63,41,18,"unread_count_user1"],[60,81,41,36],[60,85,41,40],[60,86,41,41],[60,90,41,45],[60,91,41,46],[60,94,42,12],[60,95,42,13,"conv"],[60,99,42,17],[60,100,42,18,"unread_count_user2"],[60,118,42,36],[60,122,42,40],[60,123,42,41],[60,127,42,45],[60,128,42,46],[61,10,43,8],[61,14,43,12,"hasUnread"],[61,23,43,21],[61,25,43,23,"unreadChatsCount"],[61,41,43,39],[61,43,43,41],[62,8,44,6],[62,9,44,7],[62,10,44,8],[63,8,46,6,"setUnreadCount"],[63,22,46,20],[63,23,46,21,"unreadChatsCount"],[63,39,46,37],[63,40,46,38],[64,6,47,4],[64,7,47,5],[64,8,47,6],[64,15,47,13,"error"],[64,20,47,18],[64,22,47,20],[65,8,48,6,"console"],[65,15,48,13],[65,16,48,14,"error"],[65,21,48,19],[65,22,48,20],[65,61,48,59],[65,63,48,61,"error"],[65,68,48,66],[65,69,48,67],[66,6,49,4],[67,4,50,2],[67,5,50,3],[68,4,52,2],[68,8,52,2,"useEffect"],[68,14,52,11],[68,15,52,11,"useEffect"],[68,24,52,11],[68,26,52,12],[68,32,52,18],[69,6,53,4],[69,10,53,8,"user"],[69,14,53,12],[69,16,53,14],[70,8,54,6,"refreshUnreadCount"],[70,26,54,24],[70,27,54,25],[70,28,54,26],[72,8,56,6],[73,8,57,6],[73,14,57,12,"interval"],[73,22,57,20],[73,25,57,23,"setInterval"],[73,36,57,34],[73,37,57,35,"refreshUnreadCount"],[73,55,57,53],[73,57,57,55],[73,62,57,60],[73,63,57,61],[74,8,58,6],[74,15,58,13],[74,21,58,19,"clearInterval"],[74,34,58,32],[74,35,58,33,"interval"],[74,43,58,41],[74,44,58,42],[75,6,59,4],[76,4,60,2],[76,5,60,3],[76,7,60,5],[76,8,60,6,"user"],[76,12,60,10],[76,13,60,11],[76,14,60,12],[77,4,62,2],[77,24,63,4],[77,28,63,4,"_reactJsxDevRuntime"],[77,47,63,4],[77,48,63,4,"jsxDEV"],[77,54,63,4],[77,56,63,5,"MessagesContext"],[77,71,63,20],[77,72,63,21,"Provider"],[77,80,63,29],[78,6,63,30,"value"],[78,11,63,35],[78,13,63,37],[79,8,63,39,"unreadCount"],[79,19,63,50],[80,8,63,52,"refreshUnreadCount"],[81,6,63,71],[81,7,63,73],[82,6,63,73,"children"],[82,14,63,73],[82,16,64,7,"children"],[83,4,64,15],[84,6,64,15,"fileName"],[84,14,64,15],[84,16,64,15,"_jsxFileName"],[84,28,64,15],[85,6,64,15,"lineNumber"],[85,16,64,15],[86,6,64,15,"columnNumber"],[86,18,64,15],[87,4,64,15],[87,11,65,30],[87,12,65,31],[88,2,67,0],[88,3,67,1],[89,0,67,2],[89,3]],"functionMap":{"names":["<global>","createContext$argument_0.refreshUnreadCount","useMessages","MessagesProvider","refreshUnreadCount","conversations.forEach$argument_0","useEffect$argument_0","<anonymous>"],"mappings":"AAA;sBCc,cD;2BEG,iCF;yEGE;6BCI;4BCe;ODK;GDM;YGE;aCM,6BD;GHE;CHO"},"hasCjsExports":false},"type":"js/module"}]}