{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":26,"index":105}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}},{"name":"../utils/storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":43,"index":149}}],"key":"rswhtWQFlk40P6/ZSXiz3NZSC0I=","exportNames":["*"],"imports":1}},{"name":"./AuthContext","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":150},"end":{"line":4,"column":40,"index":190}}],"key":"YmpzODa+dVz64UAAYTI+RwJeEt0=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/MessagesContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useMessages\", {\n    enumerable: true,\n    get: function () {\n      return useMessages;\n    }\n  });\n  Object.defineProperty(exports, \"MessagesProvider\", {\n    enumerable: true,\n    get: function () {\n      return MessagesProvider;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _react = require(_dependencyMap[1], \"react\");\n  var _axios = require(_dependencyMap[2], \"axios\");\n  var axios = _interopDefault(_axios);\n  var _utilsStorage = require(_dependencyMap[3], \"../utils/storage\");\n  var _AuthContext = require(_dependencyMap[4], \"./AuthContext\");\n  var _reactJsxDevRuntime = require(_dependencyMap[5], \"react/jsx-dev-runtime\");\n  const API_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL + '/api';\n  const MessagesContext = /*#__PURE__*/(0, _react.createContext)({\n    unreadCount: 0,\n    refreshUnreadCount: async () => {}\n  });\n  const useMessages = () => {\n    _s();\n    return (0, _react.useContext)(MessagesContext);\n  };\n  _s(useMessages, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n  const MessagesProvider = ({\n    children\n  }) => {\n    _s2();\n    const {\n      user\n    } = (0, _AuthContext.useAuth)();\n    const [unreadCount, setUnreadCount] = (0, _react.useState)(0);\n    const refreshUnreadCount = async () => {\n      if (!user) {\n        setUnreadCount(0);\n        return;\n      }\n      try {\n        const token = await _utilsStorage.storage.getItemAsync('session_token');\n        const response = await axios.default.get(`${API_URL}/conversations`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const conversations = response.data;\n        let totalUnread = 0;\n        conversations.forEach(conv => {\n          if (conv.user1_id === user._id) {\n            totalUnread += conv.unread_count_user1 || 0;\n          } else {\n            totalUnread += conv.unread_count_user2 || 0;\n          }\n        });\n        setUnreadCount(totalUnread);\n      } catch (error) {\n        console.error('Error fetching unread messages count:', error);\n      }\n    };\n    (0, _react.useEffect)(() => {\n      if (user) {\n        refreshUnreadCount();\n\n        // Refresh every 30 seconds\n        const interval = setInterval(refreshUnreadCount, 30000);\n        return () => clearInterval(interval);\n      }\n    }, [user]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(MessagesContext.Provider, {\n      value: {\n        unreadCount,\n        refreshUnreadCount\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 5\n    }, this);\n  };\n  _s2(MessagesProvider, \"5uz6nrhCjtb8dvvfCS3TSGZnyrs=\", false, function () {\n    return [_AuthContext.useAuth];\n  });\n  _c = MessagesProvider;\n  var _c;\n  $RefreshReg$(_c, \"MessagesProvider\");\n});","lineCount":105,"map":[[15,2,18,0,"Object"],[15,8,18,0],[15,9,18,0,"defineProperty"],[15,23,18,0],[15,24,18,0,"exports"],[15,31,18,0],[16,4,18,0,"enumerable"],[16,14,18,0],[17,4,18,0,"get"],[17,7,18,0],[17,18,18,0,"get"],[17,19,18,0],[18,6,18,0],[18,13,18,0,"useMessages"],[18,24,18,0],[19,4,18,0],[20,2,18,0],[21,2,20,0,"Object"],[21,8,20,0],[21,9,20,0,"defineProperty"],[21,23,20,0],[21,24,20,0,"exports"],[21,31,20,0],[22,4,20,0,"enumerable"],[22,14,20,0],[23,4,20,0,"get"],[23,7,20,0],[23,18,20,0,"get"],[23,19,20,0],[24,6,20,0],[24,13,20,0,"MessagesProvider"],[24,29,20,0],[25,4,20,0],[26,2,20,0],[27,2,67,2],[27,6,67,2,"_expoVirtualEnv"],[27,21,67,2],[27,24,67,2,"require"],[27,31,67,2],[27,32,67,2,"_dependencyMap"],[27,46,67,2],[28,2,1,0],[28,6,1,0,"_react"],[28,12,1,0],[28,15,1,0,"require"],[28,22,1,0],[28,23,1,0,"_dependencyMap"],[28,37,1,0],[29,2,2,0],[29,6,2,0,"_axios"],[29,12,2,0],[29,15,2,0,"require"],[29,22,2,0],[29,23,2,0,"_dependencyMap"],[29,37,2,0],[30,2,2,0],[30,6,2,0,"axios"],[30,11,2,0],[30,14,2,0,"_interopDefault"],[30,29,2,0],[30,30,2,0,"_axios"],[30,36,2,0],[31,2,3,0],[31,6,3,0,"_utilsStorage"],[31,19,3,0],[31,22,3,0,"require"],[31,29,3,0],[31,30,3,0,"_dependencyMap"],[31,44,3,0],[32,2,4,0],[32,6,4,0,"_AuthContext"],[32,18,4,0],[32,21,4,0,"require"],[32,28,4,0],[32,29,4,0,"_dependencyMap"],[32,43,4,0],[33,2,4,40],[33,6,4,40,"_reactJsxDevRuntime"],[33,25,4,40],[33,28,4,40,"require"],[33,35,4,40],[33,36,4,40,"_dependencyMap"],[33,50,4,40],[34,2,6,0],[34,8,6,6,"API_URL"],[34,15,6,13],[34,18,6,16,"_expoVirtualEnv"],[34,33,6,16],[34,34,6,16,"env"],[34,37,6,16],[34,38,6,16,"EXPO_PUBLIC_BACKEND_URL"],[34,61,6,16],[34,64,6,54],[34,70,6,60],[35,2,13,0],[35,8,13,6,"MessagesContext"],[35,23,13,21],[35,39,13,24],[35,43,13,24,"createContext"],[35,49,13,37],[35,50,13,37,"createContext"],[35,63,13,37],[35,65,13,59],[36,4,14,2,"unreadCount"],[36,15,14,13],[36,17,14,15],[36,18,14,16],[37,4,15,2,"refreshUnreadCount"],[37,22,15,20],[37,24,15,22],[37,30,15,22,"refreshUnreadCount"],[37,31,15,22],[37,36,15,34],[37,37,15,35],[38,2,16,0],[38,3,16,1],[38,4,16,2],[39,2,18,7],[39,8,18,13,"useMessages"],[39,19,18,24],[39,22,18,27,"useMessages"],[39,23,18,27],[40,4,18,27,"_s"],[40,6,18,27],[41,4,18,27],[41,11,18,33],[41,15,18,33,"useContext"],[41,21,18,43],[41,22,18,43,"useContext"],[41,32,18,43],[41,34,18,44,"MessagesContext"],[41,49,18,59],[41,50,18,60],[42,2,18,60],[43,2,18,61,"_s"],[43,4,18,61],[43,5,18,13,"useMessages"],[43,16,18,24],[44,2,20,7],[44,8,20,13,"MessagesProvider"],[44,24,20,70],[44,27,20,73,"MessagesProvider"],[44,28,20,74],[45,4,20,76,"children"],[46,2,20,85],[46,3,20,86],[46,8,20,91],[47,4,20,91,"_s2"],[47,7,20,91],[48,4,21,2],[48,10,21,8],[49,6,21,10,"user"],[50,4,21,15],[50,5,21,16],[50,8,21,19],[50,12,21,19,"useAuth"],[50,24,21,26],[50,25,21,26,"useAuth"],[50,32,21,26],[50,34,21,27],[50,35,21,28],[51,4,22,2],[51,10,22,8],[51,11,22,9,"unreadCount"],[51,22,22,20],[51,24,22,22,"setUnreadCount"],[51,38,22,36],[51,39,22,37],[51,42,22,40],[51,46,22,40,"useState"],[51,52,22,48],[51,53,22,48,"useState"],[51,61,22,48],[51,63,22,49],[51,64,22,50],[51,65,22,51],[52,4,24,2],[52,10,24,8,"refreshUnreadCount"],[52,28,24,26],[52,31,24,29],[52,37,24,29,"refreshUnreadCount"],[52,38,24,29],[52,43,24,41],[53,6,25,4],[53,10,25,8],[53,11,25,9,"user"],[53,15,25,13],[53,17,25,15],[54,8,26,6,"setUnreadCount"],[54,22,26,20],[54,23,26,21],[54,24,26,22],[54,25,26,23],[55,8,27,6],[56,6,28,4],[57,6,30,4],[57,10,30,8],[58,8,31,6],[58,14,31,12,"token"],[58,19,31,17],[58,22,31,20],[58,28,31,26,"storage"],[58,41,31,33],[58,42,31,33,"storage"],[58,49,31,33],[58,50,31,34,"getItemAsync"],[58,62,31,46],[58,63,31,47],[58,78,31,62],[58,79,31,63],[59,8,32,6],[59,14,32,12,"response"],[59,22,32,20],[59,25,32,23],[59,31,32,29,"axios"],[59,36,32,34],[59,37,32,34,"default"],[59,44,32,34],[59,45,32,35,"get"],[59,48,32,38],[59,49,32,39],[59,52,32,42,"API_URL"],[59,59,32,49],[59,75,32,65],[59,77,32,67],[60,10,33,8,"headers"],[60,17,33,15],[60,19,33,17],[61,12,33,19,"Authorization"],[61,25,33,32],[61,27,33,34],[61,37,33,44,"token"],[61,42,33,49],[62,10,33,52],[63,8,34,6],[63,9,34,7],[63,10,34,8],[64,8,36,6],[64,14,36,12,"conversations"],[64,27,36,25],[64,30,36,28,"response"],[64,38,36,36],[64,39,36,37,"data"],[64,43,36,41],[65,8,37,6],[65,12,37,10,"totalUnread"],[65,23,37,21],[65,26,37,24],[65,27,37,25],[66,8,38,6,"conversations"],[66,21,38,19],[66,22,38,20,"forEach"],[66,29,38,27],[66,30,38,29,"conv"],[66,34,38,38],[66,38,38,43],[67,10,39,8],[67,14,39,12,"conv"],[67,18,39,16],[67,19,39,17,"user1_id"],[67,27,39,25],[67,32,39,30,"user"],[67,36,39,34],[67,37,39,35,"_id"],[67,40,39,38],[67,42,39,40],[68,12,40,10,"totalUnread"],[68,23,40,21],[68,27,40,25,"conv"],[68,31,40,29],[68,32,40,30,"unread_count_user1"],[68,50,40,48],[68,54,40,52],[68,55,40,53],[69,10,41,8],[69,11,41,9],[69,17,41,15],[70,12,42,10,"totalUnread"],[70,23,42,21],[70,27,42,25,"conv"],[70,31,42,29],[70,32,42,30,"unread_count_user2"],[70,50,42,48],[70,54,42,52],[70,55,42,53],[71,10,43,8],[72,8,44,6],[72,9,44,7],[72,10,44,8],[73,8,46,6,"setUnreadCount"],[73,22,46,20],[73,23,46,21,"totalUnread"],[73,34,46,32],[73,35,46,33],[74,6,47,4],[74,7,47,5],[74,8,47,6],[74,15,47,13,"error"],[74,20,47,18],[74,22,47,20],[75,8,48,6,"console"],[75,15,48,13],[75,16,48,14,"error"],[75,21,48,19],[75,22,48,20],[75,61,48,59],[75,63,48,61,"error"],[75,68,48,66],[75,69,48,67],[76,6,49,4],[77,4,50,2],[77,5,50,3],[78,4,52,2],[78,8,52,2,"useEffect"],[78,14,52,11],[78,15,52,11,"useEffect"],[78,24,52,11],[78,26,52,12],[78,32,52,18],[79,6,53,4],[79,10,53,8,"user"],[79,14,53,12],[79,16,53,14],[80,8,54,6,"refreshUnreadCount"],[80,26,54,24],[80,27,54,25],[80,28,54,26],[82,8,56,6],[83,8,57,6],[83,14,57,12,"interval"],[83,22,57,20],[83,25,57,23,"setInterval"],[83,36,57,34],[83,37,57,35,"refreshUnreadCount"],[83,55,57,53],[83,57,57,55],[83,62,57,60],[83,63,57,61],[84,8,58,6],[84,15,58,13],[84,21,58,19,"clearInterval"],[84,34,58,32],[84,35,58,33,"interval"],[84,43,58,41],[84,44,58,42],[85,6,59,4],[86,4,60,2],[86,5,60,3],[86,7,60,5],[86,8,60,6,"user"],[86,12,60,10],[86,13,60,11],[86,14,60,12],[87,4,62,2],[87,24,63,4],[87,28,63,4,"_reactJsxDevRuntime"],[87,47,63,4],[87,48,63,4,"jsxDEV"],[87,54,63,4],[87,56,63,5,"MessagesContext"],[87,71,63,20],[87,72,63,21,"Provider"],[87,80,63,29],[88,6,63,30,"value"],[88,11,63,35],[88,13,63,37],[89,8,63,39,"unreadCount"],[89,19,63,50],[90,8,63,52,"refreshUnreadCount"],[91,6,63,71],[91,7,63,73],[92,6,63,73,"children"],[92,14,63,73],[92,16,64,7,"children"],[93,4,64,15],[94,6,64,15,"fileName"],[94,14,64,15],[94,16,64,15,"_jsxFileName"],[94,28,64,15],[95,6,64,15,"lineNumber"],[95,16,64,15],[96,6,64,15,"columnNumber"],[96,18,64,15],[97,4,64,15],[97,11,65,30],[97,12,65,31],[98,2,67,0],[98,3,67,1],[99,2,67,2,"_s2"],[99,5,67,2],[99,6,20,13,"MessagesProvider"],[99,22,20,70],[100,4,20,70],[100,12,21,19,"useAuth"],[100,24,21,26],[100,25,21,26,"useAuth"],[100,32,21,26],[101,2,21,26],[102,2,21,26,"_c"],[102,4,21,26],[102,7,20,13,"MessagesProvider"],[102,23,20,70],[103,2,20,70],[103,6,20,70,"_c"],[103,8,20,70],[104,2,20,70,"$RefreshReg$"],[104,14,20,70],[104,15,20,70,"_c"],[104,17,20,70],[105,0,20,70],[105,3]],"functionMap":{"names":["<global>","createContext$argument_0.refreshUnreadCount","useMessages","MessagesProvider","refreshUnreadCount","conversations.forEach$argument_0","useEffect$argument_0","<anonymous>"],"mappings":"AAA;sBCc,cD;2BEG,iCF;yEGE;6BCI;4BCc;ODM;GDM;YGE;aCM,6BD;GHE;CHO"},"hasCjsExports":false},"type":"js/module"}]}